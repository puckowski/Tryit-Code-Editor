const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,l=!1,n=!1;for(let s=0;s<e.length;++s)'"'!==e[s]||l||r?"'"!==e[s]||l||r?'"'===e[s]&&r&&!n||"'"===e[s]&&l&&!n?(l=!1,r=!1):'"'===e[s]&&r&&n||"'"===e[s]&&l&&n?n=!1:(n="\\"===e[s],l||r||(t+=e[s])):l=!0:r=!0;return t}function removeComments(e){let t="",r=!1,l=!1,n=!1,s=!1,i=!1,o=!1,g=!1;for(let a=0;a<e.length;++a)'"'!==e[a]||l||r?"'"!==e[a]||l||r?'"'===e[a]&&r&&!n||"'"===e[a]&&l&&!n?(l=!1,r=!1):n=('"'!==e[a]||!r||!n)&&(("'"!==e[a]||!l||!n)&&"\\"===e[a]):l=!0:r=!0,(o||!l&&!r)&&("/"!==e[a]||s?"*"!==e[a]&&(s=!1):s=!0,"/"===e[a]&&o&&i&&(o=!1,g=!0),"*"===e[a]&&s?(t=t.substring(0,t.length-1),o=!0,s=!1):i=!("*"!==e[a]||s||!o)),o||g||(t+=e[a]),g=!1;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let l="",n=!1,s=!1,i=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||n?"'"!==e[o]||s||n?'"'===e[o]&&n&&!i||"'"===e[o]&&s&&!i?(s=!1,n=!1):i=('"'!==e[o]||!n||!i)&&(("'"!==e[o]||!s||!i)&&"\\"===e[o]):s=!0:n=!0,s||n||(l+=e[o]),e[o]!==t||n||s);++o);return l}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let l="",n=!1,s=!1,i=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||n?"'"!==e[o]||s||n?'"'===e[o]&&n&&!i||"'"===e[o]&&s&&!i?(s=!1,n=!1):i=('"'!==e[o]||!n||!i)&&(("'"!==e[o]||!s||!i)&&"\\"===e[o]):s=!0:n=!0,l+=e[o],e[o]!==t||n||s);++o);return l}function seekToFirstUnquotedWord(e,t,r=0){let l="",n=!1,s=!1,i=!1;for(let o=r;o<e.length;++o)if('"'!==e[o]||s||n?"'"!==e[o]||s||n?'"'===e[o]&&n&&!i||"'"===e[o]&&s&&!i?(s=!1,n=!1):i=('"'!==e[o]||!n||!i)&&(("'"!==e[o]||!s||!i)&&"\\"===e[o]):s=!0:n=!0,l+=e[o],e[o]===t[0]&&!n&&!s){let r=!0;for(let l=0;l<t.length;++l)(e.length>o+l&&e[o+l]!==t[l]||e.length<=o+l)&&(r=!1);if(r)break}return l}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=e=>{let t="";for(e=removeComments(e);e.length>0;){let r=seekToFirstUnquotedSemicolonPreserving(e,"}"),l=removeQuotedData(r);for(;countSubstr(l,"{")!==countSubstr(l,"}");){let t=seekToFirstUnquotedSemicolonPreserving(e,"}",r.length);if(r+=t,l=removeQuotedData(r),""===t)break}let n=[];const s=[];let i=0;if(countSubstr(l,"{")>1){const l=r;let o=new Map,g=new Map;for(;removeQuotedData(r).includes("{");){let e=seekToFirstUnquotedSemicolonPreserving(r,"{"),t=removeQuotedData(e),l=!1;if(r=r.substring(e.length,r.length),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");e=e.substring(t.length,e.length);const r=t.lastIndexOf("}");t=t.substring(0,r),t=t.trim()+";",s[i].push(t),l=!0}let a=t,u=0,f=i;if(!t.includes(";")){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}for(;t.includes(";");){const a=u;i-=u,u=0;let f="";for(;removeQuotedData(e).includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),f+=" "+t}let h=removeQuotedData(f);for(;h.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(f,"}"),r=f.substring(0,t.length-1),l=f.substring(t.length,f.length);f=r,e=l+e,h=removeQuotedData(f),u++}if(t=removeQuotedData(e),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");const r=t.lastIndexOf("}");e=e.substring(r,e.length),t=t.substring(0,r),""!==t.trim()&&(t=t.trim()+";",f+=" "+t)}if(!l||l&&""!==f)if(0===a)void 0!==s[i]?Array.isArray(s[i])?(g.has(i)||g.set(i,s[i].length),s[i]=[...s[i],f]):(g.has(i)||g.set(i,0),s[i]=[s[i],f]):(g.has(i)||g.set(i,0),s[i]=f);else if(void 0!==s[i])if("string"==typeof n[i])g.has(i)||g.set(i,0),s[i]=s[i]+" "+f;else if(Array.isArray(s[i])){const e=removeQuotedData(r);let t=e.indexOf(";"),l=e.indexOf("{");if(-1===t&&(t=e.length),-1===l&&(l=e.length),Array.isArray(n[i])&&n[i].length>s[i].length&&t<l){let e=s[i];e[g.get(i)]=e[g.get(i)]+" "+f,s[i]=e}else{let e=s[i];e[o.get(i)]=e[o.get(i)]+" "+f,s[i]=e}}else g.has(i)||g.set(i,0),s[i]=s[i]+" "+f;else g.has(i)||g.set(i,0),s[i]=f;if(0===u){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}t=removeQuotedData(e)}i=f;let h=0;for(;a.includes("}");)a=a.substring(a.indexOf("}")+1,a.length),i--,h++;for(;a.includes("{");)if(a=a.substring(a.indexOf("{")+1,a.length),i++,0===h){let e=0;if(void 0!==n[i-1])if(Array.isArray(n[i-1])){let t=n[i-1].length;if(Array.isArray(n[i])||(n[i]=[]),void 0!==n[i-1]&&Array.isArray(n[i-1])&&o.set(i-1,n[i-1].length-1),0===n[i].length)for(;t>n[i].length;)n[i].unshift("");else for(e=n[i].length;t>n[i].length;)n[i].push("")}else void 0===n[i]?n[i]=[""]:Array.isArray(n[i])?n[i].unshift(""):Array.isArray(n[i])||(n[i]=["",n[i]]),void 0!==n[i-1]&&Array.isArray(n[i-1])&&o.set(i-1,n[i-1].length-1);else void 0===n[i]?n[i]=[""]:Array.isArray(n[i])?n[i].unshift(""):Array.isArray(n[i])||(n[i]=["",n[i]]),void 0!==n[i-1]&&Array.isArray(n[i-1])&&o.set(i-1,n[i-1].length-1);if(void 0!==s[i-1])if(Array.isArray(s[i-1])){let t=n[i].length;if(Array.isArray(s[i])||(s[i]=[]),0===e)for(;t>s[i].length;)s[i].unshift("");else for(;t>s[i].length;)s[i].push("")}else void 0===s[i]?s[i]=[""]:Array.isArray(s[i])?s[i].unshift(""):Array.isArray(s[i])||(s[i]=["",s[i]]);else void 0===s[i]?s[i]=[""]:Array.isArray(s[i])?s[i].unshift(""):Array.isArray(s[i])||(s[i]=["",s[i]])}else h--;if(void 0!==n[i])if("string"==typeof n[i]){n[i]=[n[i],e];const t=i;for(;i>=0;){for(;void 0!==n[i-1]&&Array.isArray(n[i-1])&&n[i-1].length<n[i].length;)for(n[i-1].push(n[i-1][n[i-1].length-1]);s[i-1].length<n[i-1].length;)s[i-1].push("");i--}i=t}else{n[i]=[...n[i],e];const t=i;for(;i>=0;){for(;void 0!==n[i-1]&&Array.isArray(n[i-1])&&n[i-1].length<n[i].length;)for(n[i-1].push(n[i-1][n[i-1].length-1]);s[i-1].length<n[i-1].length;)s[i-1].push("");i--}i=t}else if(i>1&&void 0!==n[i-1]&&Array.isArray(n[i-1])){n[i]=[];for(let e=0;e<n[i-1].length-1;++e)n[i].push("");n[i].push(e),s[i]=[];for(let e=0;e<n[i-1].length-1;++e)s[i].push("")}else toDupCount=0,n[i]=e,insertedNonArray=!0}let a,u=0;for(let e=s.length-1;e>=1;--e){const t=s[e-1];if(void 0===t)continue;const r=s[e];for(;Array.isArray(t)&&Array.isArray(r)&&t.length<r.length;)t.push("");s[e-1]=t}for(;removeQuotedData(r).includes(";");){const e=u;i-=u,u=0;let t="";for(;r.includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(r,";");r=r.substring(e.length,r.length),t+=" "+e}let l=removeQuotedData(t);for(;l.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),n=t.substring(0,e.length-1);r=t.substring(e.length,t.length)+r,t=n,u++,l=removeQuotedData(t)}if(0===e)void 0!==s[i]?"string"==typeof n[i]?(g.has(i)||g.set(i,0),s[i]=[s[i],t]):Array.isArray(s[i])?(g.has(i)||g.set(i,s[i].length),s[i]=[...s[i],t]):(g.has(i)||g.set(i,0),s[i]=[s[i],t]):(g.has(i)||g.set(i,0),s[i]=t);else if(void 0!==s[i])if("string"==typeof n[i])g.has(i)||g.set(i,0),s[i]=s[i]+" "+t;else if(Array.isArray(s[i])){const e=removeQuotedData(r);let l=e.indexOf(";"),a=e.indexOf("{");if(-1===l&&(l=e.length),-1===a&&(a=e.length),Array.isArray(n[i])&&n[i].length>s[i].length&&l<a){let e=s[i];e[g.get(i)]=e[g.get(i)]+" "+t,s[i]=e}else{let e=s[i];e[o.get(i)]=e[o.get(i)]+" "+t,s[i]=e}}else g.has(i)||g.set(i,0),s[i]=s[i]+" "+t;else g.has(i)||g.set(i,0),s[i]=t}if(r.length>0&&removeQuotedData(r).includes("}")){let e=seekToFirstUnquotedSemicolon(r,"}");const t=e.lastIndexOf("}");e=e.substring(0,t),e=e.trim()+";",s[i].push(e)}trimRules(s),e=e.substring(l.length,e.length);for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(n[e][t],"}"),l=n[e][t].substring(0,r.length-1),s=n[e][t].substring(r.length,n[e][t].length);n[e][t]=l+s}r=removeQuotedData(n[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(n[e],"}"),r=n[e].substring(0,t.length-1),l=n[e].substring(t.length,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("}"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(n[e][t],"&"),l=n[e][t].substring(0,r.length-1),s=n[e][t].substring(r.length,n[e][t].length);n[e][t]=l+s}r=removeQuotedData(n[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(n[e],"&"),r=n[e].substring(0,t.length-1),l=n[e].substring(t.length,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("&"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(n[e][t],"@nest"),l=n[e][t].substring(0,r.length-5),s=n[e][t].substring(r.length+4,n[e][t].length);n[e][t]=l+s}r=removeQuotedData(n[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(n[e],"@nest"),r=n[e].substring(0,t.length-5),l=n[e].substring(t.length+4,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("@nest"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t)n[e][t]=n[e][t].trim();else n[e]=n[e].trim();const f=new Map;for(let e=0;e<n.length;++e)void 0!==n[e]&&f.set(e,[]);void 0!==s[0]&&void 0===n[0]&&(t+=s[0]+" ");for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])&&n[t].length>r){let l=removeQuotedData(n[t][r]);for(;l.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(n[t][r],","),o=n[t][r].substring(0,i.length-1),g=n[t][r].substring(i.length,n[t][r].length);n[t][r]=g,n[t].splice(r,0,o),s[t].splice(r,0,s[t][r]);for(let t=0;t<n.length;++t)t!==e&&void 0!==n[t]&&(Array.isArray(n[t])&&n[t].length>r?n[t].splice(r,0,n[t][r]):Array.isArray(n[t])&&n[t].length===r||0===r&&(n[t]=[n[t],n[t]]));for(let t=0;t<s.length;++t)t!==e&&void 0!==s[t]&&(Array.isArray(s[t])&&s[t].length>r?s[t].splice(r,0,s[t][r]):Array.isArray(s[t])&&s[t].length===r||0===r&&(s[t]=[s[t],s[t]]));l=removeQuotedData(n[t][r])}}else if(!Array.isArray(n[t])){let l=removeQuotedData(n[t]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(n[t],","),i=n[t].substring(0,s.length-1),o=n[t].substring(s.length,n[t].length);n[t]=o,n[t]=[n[t],i],l=removeQuotedData(n[t][r]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>r?n[t].splice(r,0,n[t][r]):0===r&&(n[t]=[n[t],n[t]])}}}else{s[e];let t=0;for(let r=0;r<=e;r++)if(void 0!==n[r])if(Array.isArray(n[r])){let l=removeQuotedData(n[r][t]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(n[r][t],","),i=n[r][t].substring(0,s.length-1),o=n[r][t].substring(s.length,n[r][t].length);n[r][t]=o,n[r].splice(t,0,i),l=removeQuotedData(n[r][t]);for(let r=e+1;r<n.length;++r)Array.isArray(n[r])&&n[r].length>t?n[r].splice(t,0,n[r][t]):0===t&&(n[r]=[n[r],n[r]])}}else{let l=removeQuotedData(n[r]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(n[r],","),i=n[r].substring(0,s.length-1),o=n[r].substring(s.length,n[r].length);n[r]=o,n[r]=[n[r],i],l=removeQuotedData(n[r][t]);for(let r=e+1;r<n.length;++r)Array.isArray(n[r])&&n[r].length>t?n[r].splice(t,0,n[r][t]):0===t&&(n[r]=[n[r],n[r]])}}}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let r=n[e].length-1;r>=0;--r){const l=s[e][r];let i="",o=r,g=-1;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])&&n[t].length>o){let r=removeQuotedData(n[t][o]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t][o],","),s=n[t][o].substring(0,l.length-1),i=n[t][o].substring(l.length,n[t][o].length);n[t][o]=i,n[t].splice(o,0,s);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>o?n[t].splice(o,0,n[t][o]):0===o&&(n[t]=[n[t],n[t]]);r=removeQuotedData(n[t][o])}if(n[t][o].trim().startsWith(":")){if(""!==n[t][o]){i=i.trim()+n[t][o].trim()+" ",a=n[t][o].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t][o].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t][o].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==n[t][o]){i+=n[t][o]+" ",a=n[t][o];for(let r=0;r<l;++r)f.get(e)[r].value+=n[t][o]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t][o].trim()+" ",e-1>g&&(g=e-1))}))}}else if(!Array.isArray(n[t])){let r=removeQuotedData(n[t]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t],","),s=n[t].substring(0,l.length-1),i=n[t].substring(l.length,n[t].length);n[t]=i,n[t]=[n[t],s],r=removeQuotedData(n[t][o]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>o?n[t].splice(o,0,n[t][o]):0===o&&(n[t]=[n[t],n[t]])}if(n[t].trim().startsWith(":")){if(""!==n[t]){i=i.trim()+n[t].trim()+" ",a=n[t].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==n[t]){i+=n[t]+" ",a=n[t];for(let r=0;r<l;++r)f.get(e)[r].value+=n[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value+=n[t]+" ",e-1>g&&(g=e-1))}))}}if(i&&l){const e=formatMediaQuery(i);if(null===e)t+=i+"{"+l+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+l+"} }\n":t+=e[0]+"{"+l+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let r=0;r<f.get(e).length;++r){const n=formatMediaQuery(f.get(e)[r].value);if(null===n)t+=f.get(e)[r].value+"{"+l+"}\n";else{""!==n[1].trim()?t+=n[0]+"{"+n[1]+"{"+l+"} }\n":t+=n[0]+"{"+l+"}";for(let e=0;e<n[2];++e)t+="} "}}for(;g>=0;--g)if(void 0!==f.get(g))for(let e=0;e<f.get(g).length;++e){const r=formatMediaQuery(f.get(g)[e].value);if(null===r)t+=f.get(g)[e].value+"{"+l+"}\n";else{""!==r[1].trim()?t+=r[0]+"{"+r[1]+"{"+l+"} }\n":t+=r[0]+"{"+l+"}";for(let e=0;e<r[2];++e)t+="} "}f.get(g)[e].value=f.get(g)[e].origValue}}else{const r=s[e];let l="",i=0,o=-1;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])){let r=removeQuotedData(n[t][i]);const s=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t][i],","),s=n[t][i].substring(0,l.length-1),o=n[t][i].substring(l.length,n[t][i].length);n[t][i]=o,n[t].splice(i,0,s),r=removeQuotedData(n[t][i]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>i?n[t].splice(i,0,n[t][i]):0===i&&(n[t]=[n[t],n[t]])}if(n[t][i].trim().startsWith(":")){if(""!==n[t][i]){l=l.trim()+n[t][i].trim()+" ",a=n[t][i].trim();for(let r=0;r<s;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t][i].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t][i].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==n[t][i]){l+=n[t][i]+" ",a=n[t][i];for(let r=0;r<s;++r)f.get(e)[r].value+=n[t][i]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t][i].trim()+" ",e-1>o&&(o=e-1))}))}}else{let r=removeQuotedData(n[t]);const s=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t],","),s=n[t].substring(0,l.length-1),o=n[t].substring(l.length,n[t].length);n[t]=o,n[t]=[n[t],s],r=removeQuotedData(n[t][i]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>i?n[t].splice(i,0,n[t][i]):0===i&&(n[t]=[n[t],n[t]])}if(n[t].trim().startsWith(":")){if(""!==n[t]){l=l.trim()+n[t].trim()+" ",a=n[t].trim();for(let r=0;r<s;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==n[t]){l+=n[t]+" ",a=n[t];for(let r=0;r<s;++r)f.get(e)[r].value+=n[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t]+" ",e-1>o&&(o=e-1))}))}}if(l&&r){const e=formatMediaQuery(l);if(null===e)t+=l+"{"+r+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+r+"} }\n":t+=e[0]+"{"+r+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let l=0;l<f.get(e).length;++l){const n=formatMediaQuery(f.get(e)[l].value);if(null===n){t+=f.get(e)[l].value+"{"+r+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==f.get(t)){const e=[];for(let r=0;r<f.get(t).length;++r){const l={};l.origValue=f.get(t)[r].origValue+" "+a,l.value=f.get(t)[r].value+" "+a,l.idx=f.get(t)[r].idx,e.push(l)}const r=f.get(t).concat(e);f.set(t,r)}}else{""!==n[1].trim()?t+=n[0]+"{"+n[1]+"{"+r+"} }\n":t+=n[0]+"{"+r+"}";for(let e=0;e<n[2];++e)t+="} "}}for(;o>=0;--o)if(void 0!==f.get(o))for(let e=0;e<f.get(o).length;++e){const l=formatMediaQuery(f.get(o)[e].value);if(null===l)t+=f.get(o)[e].value+"{"+r+"}\n";else{""!==l[1].trim()?t+=l[0]+"{"+l[1]+"{"+r+"} }\n":t+=l[0]+"{"+r+"}";for(let e=0;e<l[2];++e)t+="} "}f.get(o)[e].value=f.get(o)[e].origValue}}}else e=e.substring(r.length,e.length),t+=r.trim()+"\n"}return t},atSet=new Set(["@media","@layer"]),formatMediaQuery=e=>{let t=removeQuotedData(e),r="",l=0;for(const n of atSet)for(;t.includes(n);){let s=seekToFirstUnquotedWord(e,n),i=e.substring(0,s.length-1),o=e.substring(s.length-1,e.length),g=o.substring(0,o.indexOf(n)+n.length);o=o.substring(g.length,o.length).trim();let a="",u=seekToFirstUnquotedSemicolon(o," ");for(u.length>a&&(a=u),u=seekToFirstUnquotedSemicolon(o,"{"),u.length>a&&(a=u),!o.includes(" ")&&a.length<o&&(a=o);a.includes("(")&&countSubstr(a,"(")!==countSubstr(a,")");)a=o.substring(0,o.indexOf(")",a.length)+1);o=o.substring(a.length,o.length),g+=" "+a,""===r?r+=g:"@media"===n?r+=" and "+g:"@layer"===n&&(r+=" { "+g,l++),0===l?e=i+" "+o:(""!==i.trim()&&(o=i+" "+o),e=" "+o),t=removeQuotedData(e)}return""!==r?[r,e,l]:null},stylesheets=document.querySelectorAll("style");for(const e of stylesheets){let t=applyScopedCss(e.textContent);e.textContent=t}