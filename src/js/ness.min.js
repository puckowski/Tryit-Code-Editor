const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,l=!1,i=!1;for(let s=0;s<e.length;++s){e.substring(0,s);'"'!==e[s]||l||r?"'"!==e[s]||l||r?'"'===e[s]&&r&&!i||"'"===e[s]&&l&&!i?(l=!1,r=!1):'"'===e[s]&&r&&i||"'"===e[s]&&l&&i?i=!1:(i="\\"===e[s],l||r||(t+=e[s])):l=!0:r=!0}return t}function removeComments(e){let t="",r=!1,l=!1,i=!1,s=!1,n=!1,o=!1,a=!1;for(let g=0;g<e.length;++g)'"'!==e[g]||l||r?"'"!==e[g]||l||r?'"'===e[g]&&r&&!i||"'"===e[g]&&l&&!i?(l=!1,r=!1):i=('"'!==e[g]||!r||!i)&&(("'"!==e[g]||!l||!i)&&"\\"===e[g]):l=!0:r=!0,(o||!l&&!r)&&("/"!==e[g]||s?"*"!==e[g]&&(s=!1):s=!0,"/"===e[g]&&o&&n&&(o=!1,a=!0),"*"===e[g]&&s?(t=t.substring(0,t.length-1),o=!0,s=!1):n=!("*"!==e[g]||s||!o)),o||a||(t+=e[g]),a=!1;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let l="",i=!1,s=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||i?"'"!==e[o]||s||i?'"'===e[o]&&i&&!n||"'"===e[o]&&s&&!n?(s=!1,i=!1):n=('"'!==e[o]||!i||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:i=!0,s||i||(l+=e[o]),e[o]!==t||i||s);++o);return l}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let l="",i=!1,s=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||i?"'"!==e[o]||s||i?'"'===e[o]&&i&&!n||"'"===e[o]&&s&&!n?(s=!1,i=!1):n=('"'!==e[o]||!i||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:i=!0,l+=e[o],e[o]!==t||i||s);++o);return l}function seekToFirstUnquotedWord(e,t,r=0){let l="",i=!1,s=!1,n=!1;for(let o=r;o<e.length;++o)if('"'!==e[o]||s||i?"'"!==e[o]||s||i?'"'===e[o]&&i&&!n||"'"===e[o]&&s&&!n?(s=!1,i=!1):n=('"'!==e[o]||!i||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:i=!0,l+=e[o],e[o]===t[0]&&!i&&!s){let r=!0;for(let l=0;l<t.length;++l)(e.length>o+l&&e[o+l]!==t[l]||e.length<=o+l)&&(r=!1);if(r)break}return l}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=e=>{let t="";for(e=removeComments(e);e.length>0;){let r=seekToFirstUnquotedSemicolonPreserving(e,"}"),l=removeQuotedData(r);for(;countSubstr(l,"{")!==countSubstr(l,"}");){let t=seekToFirstUnquotedSemicolonPreserving(e,"}",r.length);if(r+=t,l=removeQuotedData(r),""===t)break}let i=[];const s=[];let n=0;if(countSubstr(l,"{")>1){const l=r;let o=new Map,a=new Map;for(;removeQuotedData(r).includes("{");){let e=seekToFirstUnquotedSemicolonPreserving(r,"{"),t=removeQuotedData(e),l=!1;if(r=r.substring(e.length,r.length),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");e=e.substring(t.length,e.length);const r=t.lastIndexOf("}");t=t.substring(0,r),t=t.trim()+";",s[n].push(t),l=!0}let g=t,u=0,h=n;if(!t.includes(";")){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}for(;t.includes(";");){const g=u;n-=u,u=0;let h="";for(;removeQuotedData(e).includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),h+=" "+t}let f=removeQuotedData(h);for(;f.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(h,"}"),r=h.substring(0,t.length-1),l=h.substring(t.length,h.length);h=r,e=l+e,f=removeQuotedData(h),u++}if(t=removeQuotedData(e),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");const r=t.lastIndexOf("}");e=e.substring(r,e.length),t=t.substring(0,r),""!==t.trim()&&(t=t.trim()+";",h+=" "+t)}if(!l||l&&""!==h)if(0===g)void 0!==s[n]?Array.isArray(s[n])?(a.has(n)||a.set(n,s[n].length),s[n]=[...s[n],h]):(a.has(n)||a.set(n,0),s[n]=[s[n],h]):(a.has(n)||a.set(n,0),s[n]=h);else if(void 0!==s[n])if("string"==typeof i[n])a.has(n)||a.set(n,0),s[n]=s[n]+" "+h;else if(Array.isArray(s[n])){const e=removeQuotedData(r);let t=e.indexOf(";"),l=e.indexOf("{");if(-1===t&&(t=e.length),-1===l&&(l=e.length),Array.isArray(i[n])&&i[n].length>s[n].length&&t<l){let e=s[n];e[a.get(n)]=e[a.get(n)]+" "+h,s[n]=e}else{let e=s[n];e[o.get(n)]=e[o.get(n)]+" "+h,s[n]=e}}else a.has(n)||a.set(n,0),s[n]=s[n]+" "+h;else a.has(n)||a.set(n,0),s[n]=h;if(0===u){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}t=removeQuotedData(e)}n=h;let f=0;for(;g.includes("}");)g=g.substring(g.indexOf("}")+1,g.length),n--,f++;for(;g.includes("{");)if(g=g.substring(g.indexOf("{")+1,g.length),n++,0===f){let e=0;if(void 0!==i[n-1])if(Array.isArray(i[n-1])){let t=i[n-1].length;if(Array.isArray(i[n])||(i[n]=[]),void 0!==i[n-1]&&Array.isArray(i[n-1])&&o.set(n-1,i[n-1].length-1),0===i[n].length)for(;t>i[n].length;)i[n].unshift("");else for(e=i[n].length;t>i[n].length;)i[n].push("")}else void 0===i[n]?i[n]=[""]:Array.isArray(i[n])?i[n].unshift(""):Array.isArray(i[n])||(i[n]=["",i[n]]),void 0!==i[n-1]&&Array.isArray(i[n-1])&&o.set(n-1,i[n-1].length-1);else void 0===i[n]?i[n]=[""]:Array.isArray(i[n])?i[n].unshift(""):Array.isArray(i[n])||(i[n]=["",i[n]]),void 0!==i[n-1]&&Array.isArray(i[n-1])&&o.set(n-1,i[n-1].length-1);if(void 0!==s[n-1])if(Array.isArray(s[n-1])){let t=i[n].length;if(Array.isArray(s[n])||(s[n]=[]),0===e)for(;t>s[n].length;)s[n].unshift("");else for(;t>s[n].length;)s[n].push("")}else void 0===s[n]?s[n]=[""]:Array.isArray(s[n])?s[n].unshift(""):Array.isArray(s[n])||(s[n]=["",s[n]]);else void 0===s[n]?s[n]=[""]:Array.isArray(s[n])?s[n].unshift(""):Array.isArray(s[n])||(s[n]=["",s[n]])}else f--;if(void 0!==i[n])if("string"==typeof i[n]){i[n]=[i[n],e];const t=n;for(;n>=0;){for(;void 0!==i[n-1]&&Array.isArray(i[n-1])&&i[n-1].length<i[n].length;)for(i[n-1].push(i[n-1][i[n-1].length-1]);s[n-1].length<i[n-1].length;)s[n-1].push("");n--}n=t}else{i[n]=[...i[n],e];const t=n;for(;n>=0;){for(;void 0!==i[n-1]&&Array.isArray(i[n-1])&&i[n-1].length<i[n].length;)for(i[n-1].push(i[n-1][i[n-1].length-1]);s[n-1].length<i[n-1].length;)s[n-1].push("");n--}n=t}else if(n>1&&void 0!==i[n-1]&&Array.isArray(i[n-1])){i[n]=[];for(let e=0;e<i[n-1].length-1;++e)i[n].push("");i[n].push(e),s[n]=[];for(let e=0;e<i[n-1].length-1;++e)s[n].push("")}else toDupCount=0,i[n]=e,insertedNonArray=!0}let g,u=0;for(let e=s.length-1;e>=1;--e){const t=s[e-1];if(void 0===t)continue;const r=s[e];for(;Array.isArray(t)&&Array.isArray(r)&&t.length<r.length;)t.push("");s[e-1]=t}for(;removeQuotedData(r).includes(";");){const e=u;n-=u,u=0;let t="";for(;r.includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(r,";");r=r.substring(e.length,r.length),t+=" "+e}let l=removeQuotedData(t);for(;l.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),i=t.substring(0,e.length-1);r=t.substring(e.length,t.length)+r,t=i,u++,l=removeQuotedData(t)}if(0===e)void 0!==s[n]?"string"==typeof i[n]?(a.has(n)||a.set(n,0),s[n]=[s[n],t]):Array.isArray(s[n])?(a.has(n)||a.set(n,s[n].length),s[n]=[...s[n],t]):(a.has(n)||a.set(n,0),s[n]=[s[n],t]):(a.has(n)||a.set(n,0),s[n]=t);else if(void 0!==s[n])if("string"==typeof i[n])a.has(n)||a.set(n,0),s[n]=s[n]+" "+t;else if(Array.isArray(s[n])){const e=removeQuotedData(r);let l=e.indexOf(";"),g=e.indexOf("{");if(-1===l&&(l=e.length),-1===g&&(g=e.length),Array.isArray(i[n])&&i[n].length>s[n].length&&l<g){let e=s[n];e[a.get(n)]=e[a.get(n)]+" "+t,s[n]=e}else{let e=s[n];e[o.get(n)]=e[o.get(n)]+" "+t,s[n]=e}}else a.has(n)||a.set(n,0),s[n]=s[n]+" "+t;else a.has(n)||a.set(n,0),s[n]=t}if(r.length>0&&removeQuotedData(r).includes("}")){let e=seekToFirstUnquotedSemicolon(r,"}");const t=e.lastIndexOf("}");e=e.substring(0,t),e=e.trim()+";",s[n].push(e)}trimRules(s),e=e.substring(l.length,e.length);for(let e=0;e<i.length;++e)if(void 0!==i[e])if(Array.isArray(i[e]))for(let t=0;t<i[e].length;++t){let r=removeQuotedData(i[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(i[e][t],"}"),l=i[e][t].substring(0,r.length-1),s=i[e][t].substring(r.length,i[e][t].length);i[e][t]=l+s}r=removeQuotedData(i[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(i[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(i[e],"}"),r=i[e].substring(0,t.length-1),l=i[e].substring(t.length,i[e].length);i[e]=r+l}t=removeQuotedData(i[e])}while(t.includes("}"))}for(let e=0;e<i.length;++e)if(void 0!==i[e])if(Array.isArray(i[e]))for(let t=0;t<i[e].length;++t){let r=removeQuotedData(i[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(i[e][t],"@nest"),l=i[e][t].substring(0,r.length-5),s=i[e][t].substring(r.length+4,i[e][t].length);i[e][t]=l+s}r=removeQuotedData(i[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(i[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(i[e],"@nest"),r=i[e].substring(0,t.length-5),l=i[e].substring(t.length+4,i[e].length);i[e]=r+l}t=removeQuotedData(i[e])}while(t.includes("@nest"))}for(let e=0;e<i.length;++e)if(void 0!==i[e])if(Array.isArray(i[e]))for(let t=0;t<i[e].length;++t)i[e][t]=i[e][t].trim();else i[e]=i[e].trim();const h=new Map;for(let e=0;e<i.length;++e)void 0!==i[e]&&h.set(e,[]);void 0!==s[0]&&void 0===i[0]&&(t+=s[0]+" ");for(let e=0;e<i.length;++e)if(void 0!==i[e])if(Array.isArray(i[e]))for(let t=0;t<i[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==i[t])if(Array.isArray(i[t])&&i[t].length>r){let l=removeQuotedData(i[t][r]);for(;l.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(i[t][r],","),o=i[t][r].substring(0,n.length-1),a=i[t][r].substring(n.length,i[t][r].length);o.trim().startsWith("@media")&&!a.trim().startsWith("@media")&&(a="@media "+a),i[t][r]=a,i[t].splice(r,0,o),s[t].splice(r,0,s[t][r]);for(let t=0;t<i.length;++t)t!==e&&void 0!==i[t]&&(Array.isArray(i[t])&&i[t].length>r?i[t].splice(r,0,i[t][r]):Array.isArray(i[t])&&i[t].length===r||0===r&&(i[t]=[i[t],i[t]]));for(let t=0;t<s.length;++t)t!==e&&void 0!==s[t]&&(Array.isArray(s[t])&&s[t].length>r?s[t].splice(r,0,s[t][r]):Array.isArray(s[t])&&s[t].length===r||0===r&&(s[t]=[s[t],s[t]]));l=removeQuotedData(i[t][r])}}else if(!Array.isArray(i[t])){let l=removeQuotedData(i[t]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(i[t],","),n=i[t].substring(0,s.length-1),o=i[t].substring(s.length,i[t].length);n.trim().startsWith("@media")&&!o.trim().startsWith("@media")&&(o="@media "+o),i[t]=o,i[t]=[i[t],n],l=removeQuotedData(i[t][r]);for(let t=e+1;t<i.length;++t)Array.isArray(i[t])&&i[t].length>r?i[t].splice(r,0,i[t][r]):0===r&&(i[t]=[i[t],i[t]])}}}else{s[e];let t=0;for(let r=0;r<=e;r++)if(void 0!==i[r])if(Array.isArray(i[r])){let l=removeQuotedData(i[r][t]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(i[r][t],","),n=i[r][t].substring(0,s.length-1),o=i[r][t].substring(s.length,i[r][t].length);n.trim().startsWith("@media")&&!o.trim().startsWith("@media")&&(o="@media "+o),i[r][t]=o,i[r].splice(t,0,n),l=removeQuotedData(i[r][t]);for(let r=e+1;r<i.length;++r)Array.isArray(i[r])&&i[r].length>t?i[r].splice(t,0,i[r][t]):0===t&&(i[r]=[i[r],i[r]])}}else{let l=removeQuotedData(i[r]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(i[r],","),n=i[r].substring(0,s.length-1),o=i[r].substring(s.length,i[r].length);n.trim().startsWith("@media")&&!o.trim().startsWith("@media")&&(o="@media "+o),i[r]=o,i[r]=[i[r],n],l=removeQuotedData(i[r][t]);for(let r=e+1;r<i.length;++r)Array.isArray(i[r])&&i[r].length>t?i[r].splice(t,0,i[r][t]):0===t&&(i[r]=[i[r],i[r]])}}}for(let e=0;e<i.length;++e)if(void 0!==i[e])if(Array.isArray(i[e]))for(let r=i[e].length-1;r>=0;--r){const l=s[e][r];let n="",o=r,a=-1;for(let t=0;t<=e;t++)if(void 0!==i[t])if(Array.isArray(i[t])&&i[t].length>o){let r=removeQuotedData(i[t][o]);const l=h.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(i[t][o],","),s=i[t][o].substring(0,l.length-1),n=i[t][o].substring(l.length,i[t][o].length);i[t][o]=n,i[t].splice(o,0,s);for(let t=e+1;t<i.length;++t)Array.isArray(i[t])&&i[t].length>o?i[t].splice(o,0,i[t][o]):0===o&&(i[t]=[i[t],i[t]]);r=removeQuotedData(i[t][o])}if(i[t][o].trim().startsWith(":")){if(""!==i[t][o]){n=n.trim()+i[t][o].trim()+" ",g=i[t][o].trim();for(let r=0;r<l;++r)h.get(e)[r].value=h.get(e)[r].value.trim()+i[t][o].trim()+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+i[t][o].trim()+" ",e-1>a&&(a=e-1))}))}}else if(""!==i[t][o]){n+=i[t][o]+" ",g=i[t][o];for(let r=0;r<l;++r)h.get(e)[r].value+=i[t][o]+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=i[t][o].trim()+" ",e-1>a&&(a=e-1))}))}}else if(!Array.isArray(i[t])){let r=removeQuotedData(i[t]);const l=h.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(i[t],","),s=i[t].substring(0,l.length-1),n=i[t].substring(l.length,i[t].length);i[t]=n,i[t]=[i[t],s],r=removeQuotedData(i[t][o]);for(let t=e+1;t<i.length;++t)Array.isArray(i[t])&&i[t].length>o?i[t].splice(o,0,i[t][o]):0===o&&(i[t]=[i[t],i[t]])}if(i[t].trim().startsWith(":")){if(""!==i[t]){n=n.trim()+i[t].trim()+" ",g=i[t].trim();for(let r=0;r<l;++r)h.get(e)[r].value=h.get(e)[r].value.trim()+i[t].trim()+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+i[t].trim()+" ",e-1>a&&(a=e-1))}))}}else if(""!==i[t]){n+=i[t]+" ",g=i[t];for(let r=0;r<l;++r)h.get(e)[r].value+=i[t]+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value+=i[t]+" ",e-1>a&&(a=e-1))}))}}if(n&&l){const e=formatMediaQuery(n);if(null===e)t+=n+"{"+l+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+l+"} }\n":t+=e[0]+"{"+l+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let r=0;r<h.get(e).length;++r){const i=formatMediaQuery(h.get(e)[r].value);if(null===i)t+=h.get(e)[r].value+"{"+l+"}\n";else{""!==i[1].trim()?t+=i[0]+"{"+i[1]+"{"+l+"} }\n":t+=i[0]+"{"+l+"}";for(let e=0;e<i[2];++e)t+="} "}}for(;a>=0;--a)if(void 0!==h.get(a))for(let e=0;e<h.get(a).length;++e){const r=formatMediaQuery(h.get(a)[e].value);if(null===r)t+=h.get(a)[e].value+"{"+l+"}\n";else{""!==r[1].trim()?t+=r[0]+"{"+r[1]+"{"+l+"} }\n":t+=r[0]+"{"+l+"}";for(let e=0;e<r[2];++e)t+="} "}h.get(a)[e].value=h.get(a)[e].origValue}}else{const r=s[e];let l="",n=0,o=-1;for(let t=0;t<=e;t++)if(void 0!==i[t])if(Array.isArray(i[t])){let r=removeQuotedData(i[t][n]);const s=h.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(i[t][n],","),s=i[t][n].substring(0,l.length-1),o=i[t][n].substring(l.length,i[t][n].length);i[t][n]=o,i[t].splice(n,0,s),r=removeQuotedData(i[t][n]);for(let t=e+1;t<i.length;++t)Array.isArray(i[t])&&i[t].length>n?i[t].splice(n,0,i[t][n]):0===n&&(i[t]=[i[t],i[t]])}if(i[t][n].trim().startsWith(":")){if(""!==i[t][n]){l=l.trim()+i[t][n].trim()+" ",g=i[t][n].trim();for(let r=0;r<s;++r)h.get(e)[r].value=h.get(e)[r].value.trim()+i[t][n].trim()+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+i[t][n].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==i[t][n]){l+=i[t][n]+" ",g=i[t][n];for(let r=0;r<s;++r)h.get(e)[r].value+=i[t][n]+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=i[t][n].trim()+" ",e-1>o&&(o=e-1))}))}}else{let r=removeQuotedData(i[t]);const s=h.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(i[t],","),s=i[t].substring(0,l.length-1),o=i[t].substring(l.length,i[t].length);i[t]=o,i[t]=[i[t],s],r=removeQuotedData(i[t][n]);for(let t=e+1;t<i.length;++t)Array.isArray(i[t])&&i[t].length>n?i[t].splice(n,0,i[t][n]):0===n&&(i[t]=[i[t],i[t]])}if(i[t].trim().startsWith(":")){if(""!==i[t]){l=l.trim()+i[t].trim()+" ",g=i[t].trim();for(let r=0;r<s;++r)h.get(e)[r].value=h.get(e)[r].value.trim()+i[t].trim()+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+i[t].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==i[t]){l+=i[t]+" ",g=i[t];for(let r=0;r<s;++r)h.get(e)[r].value+=i[t]+" ";for(const[r,l]of h)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=i[t]+" ",e-1>o&&(o=e-1))}))}}if(l&&r){const e=formatMediaQuery(l);if(null===e)t+=l+"{"+r+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+r+"} }\n":t+=e[0]+"{"+r+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let l=0;l<h.get(e).length;++l){const i=formatMediaQuery(h.get(e)[l].value);if(null===i){t+=h.get(e)[l].value+"{"+r+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==h.get(t)){const e=[];for(let r=0;r<h.get(t).length;++r){const l={};l.origValue=h.get(t)[r].origValue+" "+g,l.value=h.get(t)[r].value+" "+g,l.idx=h.get(t)[r].idx,e.push(l)}const r=h.get(t).concat(e);h.set(t,r)}}else{""!==i[1].trim()?t+=i[0]+"{"+i[1]+"{"+r+"} }\n":t+=i[0]+"{"+r+"}";for(let e=0;e<i[2];++e)t+="} "}}for(;o>=0;--o)if(void 0!==h.get(o))for(let e=0;e<h.get(o).length;++e){const l=formatMediaQuery(h.get(o)[e].value);if(null===l)t+=h.get(o)[e].value+"{"+r+"}\n";else{""!==l[1].trim()?t+=l[0]+"{"+l[1]+"{"+r+"} }\n":t+=l[0]+"{"+r+"}";for(let e=0;e<l[2];++e)t+="} "}h.get(o)[e].value=h.get(o)[e].origValue}}}else e=e.substring(r.length,e.length),t+=r.trim()+"\n"}return t=formatAppendedChildren(t),t},formatAppendedChildren=e=>{let t=removeQuotedData(e);const r=/[^\s]*\s/;if(t.includes("&"))do{let l=seekToFirstUnquotedSemicolonPreserving(e,"&");if(""===l)break;let i=e.substring(0,l.length-1),s=e.substring(l.length,e.length);s.trim().startsWith("&")&&(s=s.trim().substring(1,s.length));const n=s.match(r);!n||0===n.length&&s.length>0?e=i+" "+s:n&&n.length>0&&n[0].trim().length>0?(i=i.trim(),e=i+s):e=i+" "+s,t=removeQuotedData(e)}while(t.includes("&"));return e},atSet=new Set(["@media","@layer"]),toWhitespacePattern=/[^\s]*\s/,formatMediaQuery=e=>{let t=removeQuotedData(e),r="",l=0;for(const i of atSet)for(;t.includes(i);){let s=seekToFirstUnquotedWord(e,i),n=e.substring(0,s.length-1),o=e.substring(s.length-1,e.length),a=o.substring(0,o.indexOf(i)+i.length);o=o.substring(a.length,o.length).trim();let g="",u=seekToFirstUnquotedSemicolon(o," ");for(u.length>g&&(g=u),u=seekToFirstUnquotedSemicolon(o,"{"),u.length>g&&(g=u),!o.includes(" ")&&g.length<o&&(g=o);g.includes("(")&&countSubstr(g,"(")!==countSubstr(g,")");)g=o.substring(0,o.indexOf(")",g.length)+1);o=o.substring(g.length,o.length),a+=" "+g,t=removeQuotedData(o);let h="";for(;t.includes("and");){s=seekToFirstUnquotedWord(o,"and");let e=o.substring(0,s.length-1),l=o.substring(s.length+2,o.length).trim(),i=l.match(toWhitespacePattern);if(i&&0!==i.length)if(i&&i.length>0){let t=removeQuotedData(i[0]);l=l.substring(i[0].length,l.length);let r=i[0],s=r.length+3+e.length;for(;countSubstr(t,"(")!==countSubstr(t,")")&&(i=l.match(toWhitespacePattern),i&&i.length>0);)r+=" "+i[0],s+=i[0].length,t=removeQuotedData(r);h+=" "+e+" and "+r,o=o.substring(s,o.length)}else i&&i.length>0&&(r+=" "+i[0]+" ");else r+=" and "+l,o="";t=removeQuotedData(o)}""===r?r+=a:"@media"===i?r+=" and "+a:"@layer"===i&&(r+=" { "+a,l++),r+=" "+h,0===l?e=n+" "+o:(""!==n.trim()&&(o=n+" "+o),e=" "+o),t=removeQuotedData(e)}return""!==r?[r,e,l]:null},stylesheets=document.querySelectorAll("style");for(const e of stylesheets){let t=applyScopedCss(e.textContent);e.textContent=t}